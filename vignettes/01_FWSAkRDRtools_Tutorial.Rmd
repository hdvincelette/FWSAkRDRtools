---
title: "FWSAkRDRtools Tutorial"
output:
  knitr:::html_vignette:
    toc: true
  rmdformats::downcute:
    lightbox: true
  pdf_document:
    highlight: null
    number_sections: yes
vignette: >
  %\VignetteIndexEntry{mdJSONdictio}
  %\VignetteEncoding{UTF-8}
  %\VignetteEngine{knitr::rmarkdown}
editor_options:
  markdown:
    wrap: sentence
---

```{=html}
<style type="text/css">
  body{
  font-size: 12pt;
}

</style>
```
```{css, echo=FALSE}
# .main-container {
#     max-width: 600px !important;
# }

pre {
  max-height: 350px !important;
  overflow-y: auto !important;
  overflow-x: scroll !important;
}
pre code {
  white-space: pre
}
```

The 'FWSAkRDRtools' R package is meant to help users access and manage files on the U.S.
Fish & Wildlife Service Alaska Regional Data Repository (RDR).
The RDR is a "network drive serving as a central location for authoritative project data and deliverables".
Currently, the RDR is internally maintained and can only be accessed by FWS employees connected to the Serviceâ€™s network onsite or through approved remote connection technologies, such as a [Virtual Private Network (VPN)](https://doimspp.sharepoint.com/sites/fws-FF10T00000/SitePages/GlobalProtect-Secure-Technology-Application.aspx).
Connected users can navigate to the RDR by pasting the link <file://ifw7ro-file.fws.doi.net/datamgt/> in File Explorer or a web browser (e.g., Microsoft Edge or Chrome).
Please refer to the [Draft Regional Data Repository Guidance Document](https://ecos.fws.gov/ServCat/Reference/Profile/150400) on ServCat for more information on the overall organization and management of the RDR.
Most 'FWSAkRDRtools' functions require an FWS network connection, and one function also requires write permission to the relevant 'incoming' project folder.

##### [The Alaska Regional Data Repository in File Explorer (left) and Microsoft Edge (right)]{style="color: grey;"}

<img src="https://github.com/hdvincelette/FWSAkRDRtools/raw/main/vignettes/images/RDR_file_explorer.png" width="350"/> <img src="https://github.com/hdvincelette/FWSAkRDRtools/raw/main/vignettes/images/RDR_web_browser.png" width="350"/>

##### [Function requirements]{style="color: grey;"}

```{r, echo=FALSE}

library(magrittr)

kableExtra::kable(
  utils::read.csv(
    "https://raw.githubusercontent.com/hdvincelette/FWSAkRDRtools/refs/heads/main/vignettes/data/function_requirements.csv"
  ) %>%  `colnames<-`(c("function","FWS network connection","write permission")),
  escape = F,
  align = "lcc"
)  %>% kableExtra::kable_styling(full_width = F, position = "left", font_size = 12) 

  
```

# Workspace

## Uninstall

If you have installed 'FWSAkRDRtools' previously and want to update to the latest version, you may need to uninstall the package first.
Occasionally R hits a roadblock and needs you to manually remove a package before it can proceed.

```{r, eval=FALSE}
remove.packages("FWSAkRDRtools")
.rs.restartR()
```

## Install

Install the development version of 'FWSAkRDRtools' from GitHub.
The R package 'remotes' (demonstrated here) or 'devtools' is required to install packages from GitHub.

```{r, eval=FALSE}

if (!require("remotes")) install.packages("remotes")

Sys.setenv(R_REMOTES_STANDALONE="true")
remotes::install_github("hdvincelette/FWSAkRDRtools")

```

## Load

Run the following housekeeping code to set chunk behavior within this document.

```{r setup, eval=FALSE}
options(width = 9999)

knitr::opts_chunk$set(
  echo = TRUE,
  collapse = TRUE,
  comment = "#>",
  error=TRUE
)

```

Load 'FWSAkRDRtools' into the R library and set the working directory (where you would like files to be saved and/or copied from).

```{r, eval=FALSE}
library(FWSAkRDRtools)

wd<- "C:/Users/hvincelette/OneDrive - DOI/Documents/Data_management/Test"

```

Run the following to access information about 'FWSAkRDRtools' in the Help pane, including documentation pages for each function.
You can use this as a quick reference for function usage, arguments, and expected output.

```{r}

help(package = "FWSAkRDRtools")

```

# Functions

## `get.dir.template()`: get the directory tree template

This function establishes a new directory using the standardized RDR project folder structure:

```{r, echo=FALSE, comment=NA}

rdr_folders <- c("admin", "changelog.txt", "code", "data", "data/final_data", "data/raw_data", "documents", "documents/posters", "documents/protocols", "documents/publications", "documents/reports", "documents/talks", "incoming", "metadata")        

fad_split_up <- strsplit(rdr_folders, "/")

fad_split_up[lapply(fad_split_up, length) > Inf] <- NULL

fad_subbed_out <- lapply(fad_split_up, function(x){
  n <- length(x)
  if (n > 1)
    x[n - 1] <- "|__"
  if (n > 2)
    x[1:(n - 2)] <- "   "
  x <- if (n == 1)
    c("-- ", x)
  else
    c("   ", x)
  x
})

cat(unlist(lapply(fad_subbed_out, paste, collapse = "")), sep = "\n")


```

You may use this to start organizing a files to be archived in the RDR, or to locally manage an existing RDR project.
The project name (`project`) is unrestricted, but you will be prompted to approve an overwrite if a folder with that name already exists at the local path.
You may want to include the project subprogram code and number as a prefix before the project name to align with RDR folder naming conventions (i.e., mbmlb_909).
The local path (`local.path`) is where the new directory will be created.
By default, only main project folders are included (`main = TRUE` & `incoming = FALSE`) .
Normally, data stewards only have write permission to the 'incoming' folder of an RDR project, while data managers have write and modify permissions to all folders.
This helps ensure files are not accidentally overwritten and/or lost.
If you desire to have an "incoming" folder in the new directory, use `incoming = TRUE`.

```{r, eval=FALSE}

get.dir.template(
  project = "mbmlb_909_Eskimo_Curlew_study",
  local.path = wd,
  main = TRUE,
  incoming = FALSE
)

```

## `find.projects()`: find RDR projects

```{r, eval=FALSE}

find.projects(pattern = c("red.*knot","alaska"), program = "mbm", full.path = FALSE)

```

## `find.files()`: find RDR project files

```{r, eval=FALSE}

find.files(
  pattern = c("template", "dictionary", "\\.csv", "hello"),
  project = "mbmlb_010_Grey_headed_chickadee_hybridization",
  subfolder.path = "metadata",
  main = TRUE,
  incoming = FALSE,
  recursive = TRUE,
  full.path = FALSE
)

```

## `download.files()`: download RDR project files

```{r, eval=FALSE}

download.files(
  pattern = c("banding", "dictionary"),
  project = "mbmlb_010_Grey_headed_chickadee_hybridization",
  subfolder.path = "",
  local.path = wd,
  main = TRUE,
  incoming = FALSE,
  recursive = TRUE,
  download.file.method = "auto"
)

```

## `read.tables()`: read RDR project tables into R

```{r, eval=FALSE}

df <- read.tables(
  pattern = c("dictionary"),
  project = "mbmlb_010_Grey_headed_chickadee_hybridization",
  subfolder.path = "metadata",
  main = TRUE,
  incoming = FALSE,
  recursive = TRUE,
  header = TRUE,
  na.strings = ""
)

df.list <- read.tables(
  pattern = c("\\.csv", "\\.xlsx"),
  project = "mbmlb_010_Grey_headed_chickadee_hybridization",
  subfolder.path = "",
  main = TRUE,
  incoming = FALSE,
  recursive = TRUE,
  header = TRUE,
  na.strings = ""
)

```

## `clone.project()`: clone an RDR project

```{r, eval=FALSE}

clone.project(
  project = "mbmlb_010_Grey_headed_chickadee_hybridization",
  local.path = wd,
  main = TRUE,
  incoming = TRUE
  )

```

## `summarize.files()`: summarize files in an RDR project

```{r, eval=FALSE}

file.summary<- summarize.files(
  project = "mbmlb_010_Grey_headed_chickadee_hybridization",
  subfolder = "",
  main = TRUE,
  incoming = TRUE,
  recursive = TRUE
)
```

## `commit.files()`: commit files to an RDR project

```{r, eval=FALSE}
# Note files will only be committed if you are the data steward of the project. Refer to the Data Manager to understand your project roles.

commit.summary<- commit.files(
  project = "mbmlb_010_Grey_headed_chickadee_hybridization",
  local.path = paste0(wd,"/mbmlb_010_Grey_headed_chickadee_hybridization"),
  recursive = TRUE
  )

```
